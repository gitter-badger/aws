general:
  branches:
    only:
      - master
      - dev
      - /feature-.*/
      - /test-.*/

machine:
  services:
    - docker

dependencies:
  pre:
    - scripts/prepare.sh:
        timeout: 300
  override:
    - scripts/run.sh:
        timeout: 300

test:
  override:
    - scripts/validate.sh:
        timeout: 300

deployment:
  staging:
    branch: dev
    codedeploy:
      VGH:
        application_root: /
        revision_location:
          revision_type: S3
          s3_location:
            bucket: vladgh
            key_pattern: deploy/{BRANCH}/vgh-{SHORT_COMMIT}-{BUILD_NUM}.zip
        region: us-east-1
        deployment_group: development
        deployment_config: CodeDeployDefault.OneAtATime
  production:
    branch: master
    codedeploy:
      VGH:
        application_root: /
        revision_location:
          revision_type: S3
          s3_location:
            bucket: vladgh
            key_pattern: deploy/production/vgh-{SHORT_COMMIT}-{BUILD_NUM}.zip
        region: us-east-1
        deployment_group: production
        deployment_config: CodeDeployDefault.OneAtATime
